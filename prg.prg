10 rem ------------------------------------------------------------{$0a}20 rem swiftlink tcp terminal (c64 basic v2){$0a}30 rem uses direct peek/poke to the swiftlink 6551 acia{$0a}40 rem acia register addresses (swiftlink at $de00){$0a}45 rem ------------------------------------------------------------{$0a}50 tg$="":tt=0 :rem flag for tracking html tags (1 = inside tag, 0 = outside){$0a}60 dr=56832 :rem data register (read = receive, write = transmit){$0a}70 sr=56833 :rem status register (flags: rx ready, tx ready, errors){$0a}80 cm=56834 :rem command register (parity, echo, dtr, interrupts){$0a}90 ct=56835 :rem control register (baud rate, word size, stop bits){$0a}100 rem clear screen and set text colour{$0a}110 print chr$(142);chr$(147);chr$(5);"connecting ...":s=0{$0a}120 rem reset acia by writing to status register{$0a}130 poke sr,0{$0a}140 rem control register{$0a}150 rem 31 = 8 data bits, 1 stop bit, internal clock,{$0a}160 rem baud setting doubled by swiftlink crystal = 38,400{$0a}170 poke ct,31:rem poke ct,31 on c64u and 16 on vice{$0a}180 rem command register{$0a}190 rem no parity, no echo, dtr on, receive enabled{$0a}200 poke cm,9{$0a}210 rem short delay to let hardware settle{$0a}220 for i=1 to 500:next{$0a}245 for i=1 to 3{$0a}250 b=asc("+"):gosub 850{$0a}255 next{$0a}270 rem dial tcp server (ip:port){$0a}280 ts$="atdt php.retrogamecoders.com:80"+chr$(13){$0a}290 gosub 700{$0a}300 crlf$=chr$(13)+chr$(10){$0a}310 ts$="get / http/1.1"+crlf$+"host: php.retrogamecoders.com"+crlf$+crlf${$0a}320 gosub 700{$0a}325 ht=0: rem flag for if html started (1 = started, 0 = not started){$0a}330 s=peek(sr){$0a}335 if (s and 8)=0 then goto 330{$0a}340 c=peek(dr){$0a}345 if c<>10 and c<>13 then cr=0: goto 330{$0a}350 cr=cr+1{$0a}355 if cr<4 then goto 330{$0a}360 ht=1{$0a}400 rem ------------------------------------------------------------{$0a}410 rem main loop to read and process incoming data{$0a}420 rem ------------------------------------------------------------{$0a}440 s=peek(sr){$0a}450 if (s and 8)=0 then goto 440{$0a}455 c=peek(dr){$0a}460 if c>=97 and c<=122 then c=c-32{$0a}465 if c=asc("<") then tt=1: tg$="": goto 440{$0a}470 if c=asc(">") then tt=0: goto 440{$0a}475 if tt=1 then tg$=tg$+chr$(c){$0a}480 if tt=0 and tg$<>"" then gosub 1000{$0a}585 if tt=0 and tg$="" then print chr$(c);{$0a}590 goto 440{$0a}600 end{$0a}700 rem ------------------------------------------------------------{$0a}710 rem send string ts$ character by character{$0a}720 rem ------------------------------------------------------------{$0a}730 for i=1 to len(ts$){$0a}740 b=asc(mid$(ts$,i,1)){$0a}750 gosub 800{$0a}760 next{$0a}770 return{$0a}800 rem ------------------------------------------------------------{$0a}810 rem send one byte in b{$0a}820 rem wait until transmit register is empty{$0a}830 rem bit 4 (value 16) = transmit ready{$0a}840 rem ------------------------------------------------------------{$0a}850 s=peek(sr){$0a}860 if (s and 16)=0 then 850{$0a}870 poke dr,b{$0a}880 return{$0a}1000 rem ------------------------------------------------------------{$0a}1010 rem process html tag in tg${$0a}1020 rem ------------------------------------------------------------{$0a}1025 rem print "*";tg$;"*"{$0a}1040 if tg$="h1" then print "{$7b}rvs on{$7d}";:tg$="": return{$0a}1050 if tg$="/h1" then print "{$7b}rvs off{$7d}";chr$(13);:tg$="": return{$0a}2000 tg$="": return{$0a}